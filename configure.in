AC_PREREQ(2.50)
AC_INIT(exif/main.c)
AM_CONFIG_HEADER(config.h)
AM_INIT_AUTOMAKE(exif,0.5)
AM_MAINTAINER_MODE

AM_PROG_LIBTOOL

dnl ---------------------------------------------------------------------------
dnl i18n support
dnl ---------------------------------------------------------------------------
ALL_LINGUAS="de es"
AM_GNU_GETTEXT

dnl ---------------------------------------------------------------------------
dnl libraries needed
dnl ---------------------------------------------------------------------------
PKG_CHECK_MODULES(LIBEXIF, libexif >= 0.5.4)
AC_SUBST(LIBEXIF_LIBS)
AC_SUBST(LIBEXIF_CFLAGS)

dnl ---------------------------------------------------------------------------
dnl locale.h: locale.h provides setlocale. It seems that some systems don't
dnl           have it (at least if configured --without-nls).
dnl ---------------------------------------------------------------------------
AC_CHECK_HEADERS(locale.h)

dnl ---------------------------------------------------------------------------
dnl popt.h: Simplifies handling of command-line options enormously.
dnl ---------------------------------------------------------------------------
popt_msg="no (Note that popt is mandatory, so exif won't compile)"
try_popt=true
have_popt=false
AC_ARG_WITH(popt, [  --without-popt            Don't use popt.h],
	if test "x${withval}" = "xno"; then
		try_popt=false
		popt_msg="no (not requested)"
	fi
)
if $try_popt; then
	AC_CHECK_HEADER(popt.h, [
		POPT_CFLAGS=""
		POPT_LIBS="-lpopt"
		have_popt=true
		popt_msg=yes
		AC_DEFINE(HAVE_POPT,1,[whether we use popt])],
		[rl_msg="no (couldn't link against it or version too old)"])
fi
AM_CONDITIONAL(HAVE_POPT, $have_popt)
AC_SUBST(POPT_LIBS)
AC_SUBST(POPT_CFLAGS)

dnl ---------------------------------------------------------------------------
dnl Warnings: If we have GCC, be paranoid.
dnl ---------------------------------------------------------------------------
if test "x$GCC" = "xyes"; then
    CFLAGS="$CFLAGS -Wall -Wchar-subscripts -Wmissing-declarations -Wmissing-prototypes -Wnested-externs -Wpointer-arith"
    AC_SUBST(CFLAGS)
fi

AC_OUTPUT([
  Makefile
  libjpeg/Makefile
  exif/Makefile
])

echo "

Configuration:

	Source code location:      ${srcdir}
	Compiler:                  ${CC}
"
